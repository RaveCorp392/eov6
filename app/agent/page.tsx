'use client';import {useRouter} from 'next/navigation';import {useState} from 'react';import {db,isFirebaseReady} from '@/lib/firebase';import {doc,getDoc,setDoc,serverTimestamp} from 'firebase/firestore';import {randomCode,defaultCodeLength,expiryInHours} from '@/lib/code';export default function Agent(){const r=useRouter();const[creating,setCreating]=useState(false);async function create(){if(!isFirebaseReady())return alert('Firebase not ready.');setCreating(true);try{let code='';for(let i=0;i<20;i++){code=randomCode(defaultCodeLength);const ref=doc(db,'sessions',code);const snap=await getDoc(ref);if(!snap.exists()){await setDoc(ref,{createdAt:serverTimestamp(),expiresAt:expiryInHours(1),status:'new'},{merge:true});r.push(`/agent/s/${code}`);return}}alert('Could not generate a unique code, please try again.')}finally{setCreating(false)}}return(<main className='mx-auto max-w-xl space-y-4'><h1 className='text-xl font-semibold'>Agent portal</h1><button className='rounded-xl bg-blue-700 px-4 py-3 text-white disabled:opacity-50' onClick={create} disabled={creating}>{creating?'Creatingâ€¦':'Start new session'}</button><p className='text-sm text-gray-600'>Share the code with the caller; they join at <code>eov6.com/s/&lt;code&gt;</code>.</p></main>)}
